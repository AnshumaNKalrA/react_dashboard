import React, { useState,useEffect } from 'react';
import './mendTeamVulnerability.scss'

interface VulnerabilityData{
    product: string;
    projects: number;
    libraries: number;
    vulnerabilities: {
        critical: number;
        high: number;
        medium: number;
        low: number;
    };
}


interface TeamVulnerabilityTableProps{
    selectedTeams: string[];
}

const MendTeamVulnerabilityTable: React.FC<TeamVulnerabilityTableProps> = ({ selectedTeams }) => {

    const [vulnerabilityData,setVulnerabilityData] = useState<VulnerabilityData[]>([]);

    useEffect(() => {    
        const fetchData = async () => {      
            try {      
              const data = { products: selectedTeams };    
              console.log(data)    
                
              const response = await fetch('http://172-18-42-23.core.cvent.org:80/mend/table', {      
                method: 'POST',  
                headers: {    
                  'Content-Type': 'application/json', // Correctly set for JSON data  
                },        
                body: JSON.stringify(data), // Stringify the JSON object     
              });      
              const jsonData = await response.json();      
              console.log(jsonData);    
              const teamsArray: VulnerabilityData[] = Object.entries(jsonData).map(([productName, productDetails]) => ({      
                product: productName,      
                ...(productDetails as Omit<VulnerabilityData, 'product'>),   
              }));      
              setVulnerabilityData(teamsArray);      
            } catch (error) {      
              console.error('Failed to fetch data:', error);      
            }      
          };       
        if (selectedTeams.length > 0) {    
          fetchData();    
        } else {    
          setVulnerabilityData([]);    
        }    
      }, [selectedTeams]);   

    return (
        <table className="vulnerabilityTable">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Projects</th>
                    <th>Libraries</th>
                    <th>Vulnerable Libraries</th>
                </tr>
            </thead>
            <tbody>
                {vulnerabilityData.map((item, index) => (
                    <tr key={index}>
                        <td>{item.product}</td>
                        <td>{item.projects}</td>
                        <td>{item.libraries}</td>
                        <td>
                            <div className="vulnerabilityCounts">
                                <span className="critical">Critical: {item.vulnerabilities.critical}</span>
                                <span className="high">High: {item.vulnerabilities.high}</span>
                                <span className="medium">Medium: {item.vulnerabilities.medium}</span>
                                <span className="low">Low: {item.vulnerabilities.low}</span>
                            </div>
                        </td>
                    </tr>
                ))}
            </tbody>
        </table>
    );
};

export default MendTeamVulnerabilityTable;